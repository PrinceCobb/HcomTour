<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HCOM Tour</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script>
    async function enableMotionSensors() {
      try {
        if (typeof DeviceMotionEvent !== "undefined" && typeof DeviceMotionEvent.requestPermission === "function") {
          const permission = await DeviceMotionEvent.requestPermission();
          if (permission === "granted") startMotionTracking();
        } else {
          startMotionTracking();
        }
      } catch (error) {
        console.error("Motion sensor access denied:", error);
      }
    }
    function startMotionTracking() {
      window.addEventListener("devicemotion", (event) => console.log("Motion sensors activated:", event));
    }
    document.addEventListener("DOMContentLoaded", enableMotionSensors);
    document.addEventListener("click", enableMotionSensors);
    document.addEventListener("touchstart", enableMotionSensors);
  </script>
  
  <style>
    body { background-color: white !important; }
    .a-dialog-overlay, .a-dialog, .hidden { display: none !important; pointer-events: none; }
    #play-button {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      width: 180px; height: 70px; z-index: 10;
      background-color: #006a4b; color: white; border: none; border-radius: 5px;
      font-size: 18px; font-weight: 500; font-family: 'Barlow', sans-serif; cursor: pointer;
    }
    #control-frame {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      width: 360px; height: 100px; display: flex; align-items: center; justify-content: space-between;
      background: rgba(0, 0, 0, 0.0); padding: 10px; border-radius: 10px; z-index: 999;
    }
    #play-pause-button, #skip-button { cursor: pointer; }
    #play-pause-button {
      width: 50px; height: 50px; background-color: rgba(0, 0, 0, 0.7); color: white;
      border: none; border-radius: 50%; font-size: 24px; display: flex; align-items: center; justify-content: center;
    }
    #video-timeline {
      width: 100%; height: 8px; background: #ddd; border-radius: 5px; cursor: pointer;
    }
    #video-timeline::-webkit-slider-thumb {
      appearance: none; width: 14px; height: 14px; background: #006a4b; border-radius: 50%; cursor: pointer;
    }
  </style>
</head>
<body>

  <button id="play-button">Start Experience</button>
  <div id="control-frame">
    <button id="play-pause-button">▶</button>
    <div id="video-controls"><input type="range" id="video-timeline" min="0" value="0" step="0.1"></div>
    <img id="skip-button" src="https://m2qall8jajdg-hls-push.5centscdn.com/btn/skipintro.png"/>
  </div>

  <a-scene id="scene" loading-screen="enabled:false">
    <a-assets>
      <video id="intro-video" crossorigin="anonymous" playsinline preload="none"></video>
      <video id="scene-two-video" src="https://m2qall8jajdg-hls-push.5centscdn.com/mp4/comp/OMM.mp4" crossorigin="anonymous" playsinline muted preload="auto"></video>
      <!-- Other video and image assets omitted for brevity -->
    </a-assets>
    <a-videosphere id="video-sky" src="#intro-video" rotation="0 268 0" playsinline></a-videosphere>
    <a-camera><a-cursor raycaster="objects: .clickable" color="yellow"></a-cursor></a-camera>
    <!-- Menu and Home button entities omitted for brevity -->
  </a-scene> 

  <script>
    const playButton = document.getElementById("play-button");
    const introVideo = document.getElementById("intro-video");
    const allVideos = [introVideo, /* other videos */];
    const playPauseButton = document.getElementById("play-pause-button");
    const videoTimeline = document.getElementById("video-timeline");
    const skipButton = document.getElementById("skip-button");
    const cursor = document.querySelector("a-cursor");
    let lastPlayedVideo = null;

    document.addEventListener("DOMContentLoaded", () => {
      introVideo.removeAttribute("src");
      introVideo.load();
      playPauseButton.style.display = "none";
    });

    function getCurrentPlayingVideo() {
      return allVideos.find((v) => !v.paused && v.readyState >= 3) || lastPlayedVideo;
    }

    playPauseButton.addEventListener("click", () => {
      const currentVideo = getCurrentPlayingVideo();
      if (currentVideo) {
        if (currentVideo.paused) {
          currentVideo.muted = false; currentVideo.play();
          playPauseButton.textContent = "II"; lastPlayedVideo = currentVideo;
        } else { currentVideo.pause(); playPauseButton.textContent = "▶"; }
      }
    });

    allVideos.forEach((video) => {
      video.addEventListener("play", () => { lastPlayedVideo = video; playPauseButton.style.display = "flex"; playPauseButton.textContent = "II"; });
      video.addEventListener("pause", () => { playPauseButton.style.display = "flex"; playPauseButton.textContent = "▶"; });
      video.addEventListener("ended", () => { playPauseButton.style.display = "none"; });
      video.addEventListener("timeupdate", updateTimeline);
    });

    function updateTimeline() {
      const currentVideo = getCurrentPlayingVideo();
      if (currentVideo && currentVideo.duration) {
        videoTimeline.max = currentVideo.duration;
        videoTimeline.value = currentVideo.currentTime;
      }
    }

    videoTimeline.addEventListener("change", () => {
      const currentVideo = getCurrentPlayingVideo();
      if (currentVideo) currentVideo.currentTime = videoTimeline.value;
    });

    playButton.addEventListener("click", () => {
      playButton.style.display = "none";
      const hlsUrl = 'https://m2qall8jajdg-hls-push.5centscdn.com/mp4/comp/intro-test.mp4/playlist.m3u8';
      if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(hlsUrl);
        hls.attachMedia(introVideo);
        hls.on(Hls.Events.MANIFEST_PARSED, () => { introVideo.muted = false; introVideo.play(); });
      } else if (introVideo.canPlayType("application/vnd.apple.mpegurl")) {
        introVideo.src = hlsUrl; introVideo.muted = false; introVideo.play();
      }
    });

    skipButton.addEventListener("click", () => {
      introVideo.currentTime = Math.max(0, introVideo.duration - 2);
      introVideo.play();
      skipButton.style.display = "none";
    });
  </script>

</body>
</html>
